--- a/tools/mkimage.c
+++ b/tools/mkimage.c
@@ -37,6 +37,7 @@ struct mkimage_params params = {
 	.arch = IH_ARCH_PPC,
 	.type = IH_TYPE_KERNEL,
 	.comp = IH_COMP_GZIP,
+	.magic = IH_MAGIC,
 	.dtc = MKIMAGE_DEFAULT_DTC_OPTIONS,
 	.imagename = "",
 };
@@ -186,6 +187,16 @@ main (int argc, char **argv)
 					genimg_get_comp_id (*++argv)) < 0)
 					usage ();
 				goto NXTARG;
+			case 'M':
+				if (--argc <=0)
+					usage ();
+				params.magic = strtoul (*++argv, &ptr, 16);
+				if (*ptr) {
+					fprintf (stderr,
+						"%s: invalid magic %s\n",
+						params.cmdname, *argv);
+				}
+				goto NXTARG;
 			case 'D':
 				if (--argc <= 0)
 					usage ();
@@ -596,12 +607,13 @@ usage ()
 	fprintf (stderr, "Usage: %s -l image\n"
 			 "          -l ==> list image header information\n",
 		params.cmdname);
<<<<<<< HEAD
-	fprintf (stderr, "       %s [-x] -A arch -O os -T type -C comp "
+	fprintf (stderr, "       %s [-x] -A arch -O os -T type -C comp -M magic "
 			 "-a addr -e ep -n name -d data_file[:data_file...] image\n"
 			 "          -A ==> set architecture to 'arch'\n"
 			 "          -O ==> set operating system to 'os'\n"
 			 "          -T ==> set image type to 'type'\n"
 			 "          -C ==> set compression type 'comp'\n"
+			 "          -M ==> set image magic to 'magic'\n"
 			 "          -a ==> set load address to 'addr' (hex)\n"
 			 "          -e ==> set entry point to 'ep' (hex)\n"
 			 "          -n ==> set image name to 'name'\n"
--- a/tools/mkimage.h
+++ b/tools/mkimage.h
@@ -65,6 +65,7 @@ struct mkimage_params {
=======
 	fprintf(stderr,
-		"       %s [-x] -A arch -O os -T type -C comp -a addr -e ep -n name -d data_file[:data_file...] image\n"
+		"       %s [-x] -A arch -O os -T type -C comp -M magic -a addr -e ep -n name -d data_file[:data_file...] image\n"
 		"          -A ==> set architecture to 'arch'\n"
 		"          -O ==> set operating system to 'os'\n"
 		"          -T ==> set image type to 'type'\n"
 		"          -C ==> set compression type 'comp'\n"
+		"          -M ==> set image magic to 'magic'\n"
 		"          -a ==> set load address to 'addr' (hex)\n"
 		"          -e ==> set entry point to 'ep' (hex)\n"
 		"          -n ==> set image name to 'name'\n"
@@ -143,7 +145,7 @@ static void process_args(int argc, char
 	int opt;
 
 	while ((opt = getopt(argc, argv,
-			     "a:A:b:c:C:d:D:e:Ef:Fk:i:K:ln:N:p:O:rR:qsT:vVx")) != -1) {
+			     "a:A:b:c:C:d:D:e:Ef:Fk:i:K:lM:n:N:p:O:rR:qsT:vVx")) != -1) {
 		switch (opt) {
 		case 'a':
 			params.addr = strtoull(optarg, &ptr, 16);
@@ -221,6 +223,14 @@ static void process_args(int argc, char
 		case 'l':
 			params.lflag = 1;
 			break;
+		case 'M':
+			params.magic = strtoull(optarg, &ptr, 16);
+			if (*ptr) {
+				fprintf(stderr,	"%s: invalid magic %s\n",
+					params.cmdname, optarg);
+				exit(EXIT_FAILURE);
+			}
+			break;
 		case 'n':
 			params.imagename = optarg;
 			break;
--- a/tools/default_image.c
+++ b/tools/default_image.c
@@ -120,7 +120,7 @@ static void image_set_header(void *ptr,
 	}
 
 	/* Build new header */
-	image_set_magic(hdr, IH_MAGIC);
+	image_set_magic(hdr, params->magic);
 	image_set_time(hdr, time);
 	image_set_size(hdr, imagesize);
 	image_set_load(hdr, addr);
--- a/tools/imagetool.h
+++ b/tools/imagetool.h
@@ -53,6 +53,7 @@ struct image_tool_params {
>>>>>>> 418362b1cc106b9aca3905150199f60548906fff
 	int arch;
 	int type;
 	int comp;
+	unsigned int magic;
 	char *dtc;
 	unsigned int addr;
 	unsigned int ep;
--- a/tools/default_image.c
+++ b/tools/default_image.c
@@ -111,7 +111,7 @@ static void image_set_header(void *ptr,
 			sbuf->st_size - sizeof(image_header_t));
 
 	/* Build new header */
-	image_set_magic(hdr, IH_MAGIC);
+	image_set_magic(hdr, params->magic);
 	image_set_time(hdr, sbuf->st_mtime);
 	image_set_size(hdr, sbuf->st_size - sizeof(image_header_t));
 	image_set_load(hdr, params->addr);
